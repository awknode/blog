<!DOCTYPE html>
<html>
  <head>
    <title>Docker Getting Started</title>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />


<link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
<link rel="stylesheet" href="/assets/css/main.css" />
<link rel="stylesheet" href="/assets/css/style.css" />
<link rel="stylesheet" href="/assets/css/navigators/navbar.css" />


<link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />


<link rel="icon" type="image/png" href="/assets/images/favicon.png" />


<link rel="stylesheet" href="/assets/css/style.css" />

    
<meta name="description" content="summary of blogpost" />
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css"
/>
<link rel="stylesheet" href="/assets/css/single.css" />
<link rel="stylesheet" href="/assets/css/navigators/sidebar.css">


    
    
  </head>

  <body data-spy="scroll" data-target="#TableOfContents" data-offset="80">
    <div class="container-fluid bg-dimmed wrapper">
      
      
    <nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
  <div class="container">
    
    
    
      
    
    
      
    
      <button class="navbar-toggler navbar-light" id="sidebar-toggler" type="button" onclick="toggleSidebar()">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" href="https://blog.internetz.me/">
      <img src="/assets/images/main-logo.png">shit i like</a>
    <button class="navbar-toggler navbar-light" id="toc-toggler" type="button" onclick="toggleTOC()">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="top-nav-items">
      <ul class="navbar-nav ml-auto">
      </ul>
    </div>
  </div>
  
  <img src="/assets/images/main-logo.png" class="d-none" id="main-logo">
  <img src="/assets/images/inverted-logo.png" class="d-none" id="inverted-logo">
</nav>



      
       

      
      
<section class="content-section" id="content-section">
  <div class="content">
    <div class="container p-0 read-area">
      
      <div class="hero-area col-sm-12" id="hero-area" style='background-image: url(https://blog.internetz.me/assets/images/default-hero.jpg);'>
      </div>

      
      <div class="page-content">
        <div class="author-profile ml-auto align-self-lg-center">
          <img class="rounded-circle" src='/images/avatar.png'/>
          <h5 class="author-name">loeken</h5>
          <p>June 5, 2020</p>
        </div>

        <div class="title">
          <h1>Docker Getting Started</h1>
        </div>

        <div class="post-content" id="post-content">
          <style>
img {
  width: 100%;
  height: auto;
}
</style>
<h2 id="docker">Docker</h2>
<p><img src="/media/img/docker_container.png" alt="Docker Container">
A docker container is a packaged application with all necessary dependencies and configuration included to move, share and run an application.</p>
<h3 id="the-video-version-of-this">The video version of this:</h3>
<p><a href="https://www.youtube.com/watch?v=krQfc6q7LS4">Road to Kubernetes - 01-  docker basics &amp; getting started - k3s / k8s</a>
<img src="https://i.ytimg.com/vi/krQfc6q7LS4/hqdefault.jpg" alt="Road to Kubernetes - 01-  docker basics & getting started - k3s / k8s"></p>
<h3 id="why-use-it-">Why use it ?</h3>
<ul>
<li>Docker compared to virtual machines do not have their own kernel running but use the kernel from the host system. ( less ram usage )</li>
<li>Developer friendly. Docker client/images/repositories/docker-compose etc makes it easier for the non op</li>
<li>A standard between devs / a standard between ops/devs (emergence of devops&hellip;.)</li>
<li>public image repositories. since docker became famous often images available from the application maintainers themselved.</li>
<li>easy to run different versions of the application(s)</li>
</ul>
<h3 id="why-maybe-not-">Why maybe not ?</h3>
<ul>
<li>easy to get working, easy to fuck up too</li>
<li>resource starvation: As all the containers share the same kernel and the same resources, if the access to some resource is not constrained, one container can use it all up and starve the host OS and the other containers.
On a VM, the resources are defined by the hypervisor, so no VM can deny the host OS from any resource, as the hypervisor itself can be configured to make restricted use of resources</li>
<li>security
<ul>
<li>kernel exploits from container</li>
<li>Data separation ( On a docker container, there&rsquo;re some resources that are not namespaced / If any attacker can exploit any of those elements, they will own the host OS.):
<ul>
<li>SELinux</li>
<li>Cgroups</li>
<li>file systems under /sys, /proc/sys,</li>
<li>/proc/sysrq-trigger, /proc/irq, /proc/bus</li>
<li>/dev/mem, /dev/sd* file system</li>
<li>Kernel Modules
A VM OS will not have direct access to any of those elements. It will talk to the hypervisor, and the hypervisor will make the appropriate system calls to the host OS. It will filter out invalid calls, adding a layer of security.</li>
</ul>
</li>
<li>Raw Sockets
The default Docker Unix socket (/var/run/docker.sock) can be mounted by any container if not properly secured. If some container mounts this socket, it can shutdown, start or create new images.</li>
</ul>
</li>
</ul>
<h3 id="how-do-they-work">How do they work?</h3>
<p>Docker is written in Go and takes advantage of several features of the Linux kernel to deliver its functionality.
Docker uses a technology called namespaces to provide the isolated workspace called the container. When you run a container, Docker creates a set of namespaces for that container.
These namespaces provide a layer of isolation. Each aspect of a containers runs in a separate namespace its access is limited to the namespace..</p>
<p>Docker uses the following namespaces on Linux:</p>
<ul>
<li>the pid namespace ( processes )</li>
<li>the net namespace ( networking )s</li>
<li>the ipc namespace ( inter process communication )</li>
<li>the mnt namespace ( mounting )</li>
<li>the uts namespace ( unix timesharing system )</li>
</ul>
<p>there are further  things used like cgroups etc., but the core of docker is archived by using kernel namespaces.</p>
<p>TLDR:
Take a look at the dockerd section: ( containerd is running but no containers )
<img src="/media/img/pstree_docker_no_container_running.png" alt="">
We now startup a docker with an interactive terminal ( -it ) which opens up bash inside the containerd-shim</p>
<p>We&rsquo;ll use the following docker container to take a look how docker works</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> debian:latest</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> groupadd -g <span style="color:#ae81ff">1000</span> dockergroup <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    useradd -d /home/dockeruser -r -u <span style="color:#ae81ff">1000</span> -g dockergroup dockeruser<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt update -y<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> apt install -y procps<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> dockeruser</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;tail&#34;</span>, <span style="color:#e6db74">&#34;/dev/null&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>we now build the image and start it up</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker buid -t debian-nonroot .
docker run -v $PWD:/home/dockeruser/shared_folder -it debian-nonroot /bin/bash
</code></pre></div><p><img src="/media/img/pstree_docker_container_running.png" alt=""></p>
<p>now inside the docker terminal we got from the docker run command we can run a long lasting process</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">watch <span style="color:#e6db74">&#34;ps ax&#34;</span>
</code></pre></div><p><img src="/media/img/pstree_docker_with_watch.png" alt=""></p>
<p>if we now compare pids from the host to the container you will notice that both host/container show the watch process but with different pids
(namespaces do the mapping)</p>
<h3 id="containerd">Containerd</h3>
<p>Runtime requirments for containerd are minimal and are handeled via runc
Is started by dockerd</p>
<h3 id="runc">RunC</h3>
<p>runc is a cli tool for spawning and running containers to OCI specification</p>
<h3 id="docker-client">Docker Client</h3>
<p>a command line tool that communicates with a docker daemon</p>
<p>A good deep dive into this can be found: <a href="https://www.youtube.com/watch?v=-YnMr1lj4Z8">on LiveOverflow&rsquo;s youtube video</a></p>
<h3 id="docker-containers">Docker Containers</h3>
<p>Container is a running environment for an Image</p>
<h3 id="docker-images">Docker Images</h3>
<p>Images can be found on <a href="https://hub.docker.com">https://hub.docker.com</a></p>
<h3 id="difference-between-containers-and-images">difference between containers and images:</h3>
<p>TLDR: You grab an image from dockerhub and the moment you run the image you are basically creating a container that is based on this image.
with docker start/stop/log you are then working with the container not the image.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker pull redis
</code></pre></div><p>list images</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker images                                                                                                                                                      
 REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE
 redis                     latest              36304d3b4540        <span style="color:#ae81ff">7</span> days ago          104MB
 atlassian/jira-software   latest              b221dfd59c57        <span style="color:#ae81ff">3</span> weeks ago         766MB
 blacklabelops/jira        latest              167698547c34        <span style="color:#ae81ff">12</span> months ago       702MB
 tutum/mysql               5.6                 ffe19c282aec        <span style="color:#ae81ff">4</span> years ago         472MB
</code></pre></div><h3 id="manage-dockers">Manage Dockers</h3>
<p>start docker in attached mode</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run redis                                                                                                                                                 
1:C <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.520 <span style="color:#75715e"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
1:C <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.520 <span style="color:#75715e"># Redis version=6.0.4, bits=64, commit=00000000, modified=0, pid=1, just started</span>
1:C <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.520 <span style="color:#75715e"># Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
1:M <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.522 * Running mode<span style="color:#f92672">=</span>standalone, port<span style="color:#f92672">=</span>6379.
1:M <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.522 <span style="color:#75715e"># Server initialized</span>
1:M <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.522 <span style="color:#75715e"># WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.</span>
1:M <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.522 <span style="color:#75715e"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command &#39;echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled&#39; as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</span>
1:M <span style="color:#ae81ff">05</span> Jun <span style="color:#ae81ff">2020</span> 12:05:35.522 * Ready to accept connections
</code></pre></div><p>start docker in detached mode ( returns id which can be used to interact with it later on, or just the first 12 chars of it )</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d --name redistest redis                                                                                                                                             
770cc49014c42afdda5ff60e1db6f4a8903c5f6c0e755c4dac51d5c7138a9ebc
</code></pre></div><p>simple commands to start/stop</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker ps                                                                                                                                                              1.14   14:25  
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES
770cc49014c4        redis               <span style="color:#e6db74">&#34;docker-entrypoint.s…&#34;</span>   <span style="color:#ae81ff">2</span> seconds ago       Up <span style="color:#ae81ff">1</span> second         6379/tcp            redistest

docker stop 770cc49014c4                                                                                                                                               0.06   14:25  
do770cc49014c4

docker ps                                                                                                                                                              0.61   14:26  
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES

docker start 770cc49014c4                                                                                                                                              0.06   14:26  
docker 770cc49014c4

docker stop redistest                                                                                                                                                  0.77   14:26  
redistest

docker start redistest                                                                                                                                                 0.49   14:26  
redistest

docker stop 770cc49014c4                                                                                                                                               0.73   14:26  
770cc49014c4

</code></pre></div><p>Bind port 12345 on the hostsystem to port 6379 inside the container</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -p 12345:6379 -d --name redistest2 redis                                                                                                              <span style="color:#ae81ff">125</span> ↵  0.06   14:28  
a900c1787086d2bbbb1c025d6b8bdf242a7f0cd38c1f82f92a44aad0a17efaec
</code></pre></div><p>Logs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker logs redistest2
</code></pre></div><p>Debugging Docker by starting it with the &ldquo;-it - interactive terminal&rdquo; flag</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -it --name redistest3 redis /bin/bash                                                                                                                       4.48   14:31  
root@1c83696bfd23:/data# 
</code></pre></div><p>TLDR:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run - creates container from image
docker start/stop - starts a container
</code></pre></div>
        </div>

        
        
          <div class="btn-improve-page">
              <a href="https://github.com/hossainemruz/toha-example-site/edit/master/content/posts/docker-getting-started.md">
                <i class="fas fa-code-branch"></i>
                Improve This Page
              </a>
          </div>
        

        
      <hr />
        <div class="row next-prev-navigator">


  

  

  

  

  

  
    
      
      <div class="col-md-6 previous-article">
        <a href="/posts/docker-create-images-in-a-private-self-hosted-registry/" class="btn btn-outline-info">
          <span><i class="fas fa-chevron-circle-left"></i> Prev</span>
          <br />
          <span>Docker Create Images in a Private Self Hosted Registry</span>
        </a>
      </div>
      
    
    
      
        
        
          
              
          
        
        <div class="col-md-6 next-article">
          <a href="/posts/building-custom-nginx-deb-package-with-fpm/" class="btn btn-outline-info">
            <span>Next <i class="fas fa-chevron-circle-right"></i></span>
            <br />
            <span>Building Nginx Deb Package With Fpm - effin package manager</span>
          </a>
        </div>
      
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</div>

      <hr />
      
      
          <div id="disqus_thread"></div>
<script type="text/javascript">
  (function () {
    
    
    if (window.location.hostname == "localhost") return;

    var dsq = document.createElement("script");
    dsq.type = "text/javascript";
    dsq.async = true;
    var disqus_shortname = "does-not-exist";
    dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
    (
      document.getElementsByTagName("head")[0] ||
      document.getElementsByTagName("body")[0]
    ).appendChild(dsq);
  })();
</script>
<noscript
  >Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript"
    >comments powered by Disqus.</a
  ></noscript
>
<a href="https://disqus.com/" class="dsq-brlink"
  >comments powered by <span class="logo-disqus">Disqus</span></a
>

      
      </div>
    </div>
  </div>
</section>


      
      
  <section class="toc-section" id="toc-section">
    
    <div class="toc-holder">
      <h5 class="text-center pl-3">Table of Contents</h5>
      <hr>
      <div class="toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#docker">Docker</a>
      <ul>
        <li><a href="#the-video-version-of-this">The video version of this:</a></li>
        <li><a href="#why-use-it-">Why use it ?</a></li>
        <li><a href="#why-maybe-not-">Why maybe not ?</a></li>
        <li><a href="#how-do-they-work">How do they work?</a></li>
        <li><a href="#containerd">Containerd</a></li>
        <li><a href="#runc">RunC</a></li>
        <li><a href="#docker-client">Docker Client</a></li>
        <li><a href="#docker-containers">Docker Containers</a></li>
        <li><a href="#docker-images">Docker Images</a></li>
        <li><a href="#difference-between-containers-and-images">difference between containers and images:</a></li>
        <li><a href="#manage-dockers">Manage Dockers</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    </div>
    
  </section>

    </div>

    <footer class="container-fluid text-center align-content-center footer pb-2">
  <div class="container pt-5">
    <div class="row text-left">
      <div class="col-md-4 col-sm-12">
        <h5>Navigation</h5>
        
        <ul>
            
            <li class="nav-item">
              <a class="smooth-scroll" href="/#recent-posts">Recent Posts</a>
            </li>
            
            
            <li class="nav-item">
              <a class="smooth-scroll" href="/#projects">Projects</a>
            </li>
            
            
            <li class="nav-item">
              <a class="smooth-scroll" href="/#skills">Skills</a>
            </li>
            
        </ul>
        

      </div>
      <div class="col-md-4 col-sm-12">
        <h5>Contact Me</h5>
        <ul>
          
          <li><span>Email: </span> <span>loeken@internetz.me</span></li>
          
        </ul>
      </div>
      
    </div>
  </div>
  <hr />
  <div class="container">
    <div class="row text-left">
      <div class="col-md-4">
        <a id="theme" href="https://github.com/hossainemruz/toha" target="#">
          <img src="/assets/images/inverted-logo.png">
          Toha
        </a>
      </div>
      <div class="col-md-4 text-center">© 2020 Copyright.</div>
      <div class="col-md-4 text-right">
        <a id="hugo" href="https://gohugo.io/">Powered by Hugo
        <img
          src="/assets/images/hugo-logo-wide.svg"
          alt="Hugo Logo"
          height="18"
        />
        </a>
      </div>
    </div>
  </div>
</footer>

    <script src="/assets/js/jquery-3.4.1.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>

<script src="/assets/js/navbar.js"></script>
<script src="/assets/js/main.js"></script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="/assets/js/single.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>


  </body>
</html>
